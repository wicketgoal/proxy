<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Proxy Demo - Educational</title>
    <link href="https://vjs.zencdn.net/8.0.4/video-js.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        #videoPlayer {
            width: 100%;
            height: 500px;
            margin: 20px 0;
        }
        .controls {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        input[type="text"] {
            width: 70%;
            padding: 12px;
            background: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            padding: 12px 24px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #0077bb;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info { background: #2a4a5a; }
        .success { background: #2a5a2a; }
        .error { background: #5a2a2a; }
        .examples {
            background: #2a2a5a;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .method-selector {
            background: #3a2a5a;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé• Educational Video Proxy Demo</h1>
        <p>This demonstrates how video proxies work for educational purposes.</p>

        <div class="method-selector">
            <h3>üîß Choose Proxy Method:</h3>
            <button onclick="useCorsProxy()">Use CORS Proxy</button>
            <button onclick="useDirect()">Try Direct (No Proxy)</button>
            <button onclick="useAllOrigins()">Use AllOrigins Proxy</button>
        </div>

        <div class="examples">
            <h3>üì∫ Test Streams (Click to load):</h3>
            <button onclick="loadStream('https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8')">Test Stream 1</button>
            <button onclick="loadStream('https://cph-p2p-msl.akamaized.net/hls/live/2000341/test/master.m3u8')">Test Stream 2</button>
            <button onclick="loadStream('https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8')">Test Stream 3</button>
        </div>

        <div class="controls">
            <h3>üîó Or Enter Custom Stream URL:</h3>
            <input type="text" id="streamUrl" placeholder="Paste .m3u8 URL here">
            <button onclick="loadCustomStream()">Load Custom Stream</button>
        </div>

        <div id="status" class="status info">Ready! Choose a stream above.</div>

        <video-js id="videoPlayer" class="video-js vjs-default-skin" controls preload="auto">
            <p class="vjs-no-js">
                To view this video please enable JavaScript.
            </p>
        </video-js>

        <div class="info">
            <h3>‚ÑπÔ∏è Educational Information:</h3>
            <p>This demo shows different methods to handle CORS issues with video streams:</p>
            <ul>
                <li><strong>CORS Proxy:</strong> Routes through a public proxy service</li>
                <li><strong>Direct:</strong> Tries to play stream directly (may fail due to CORS)</li>
                <li><strong>AllOrigins:</strong> Uses allorigins.win proxy service</li>
            </ul>
            <p><strong>Note:</strong> For educational purposes only. Use only with public test streams.</p>
        </div>
    </div>

    <script src="https://vjs.zencdn.net/8.0.4/video.min.js"></script>
    <script>
        let player;
        let currentMethod = 'cors'; // 'cors', 'direct', 'allorigins'

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            console.log(message);
        }

        function useCorsProxy() {
            currentMethod = 'cors';
            updateStatus('‚úÖ Using CORS Proxy method', 'success');
        }

        function useDirect() {
            currentMethod = 'direct';
            updateStatus('‚ö†Ô∏è Using Direct method (may fail due to CORS)', 'info');
        }

        function useAllOrigins() {
            currentMethod = 'allorigins';
            updateStatus('‚úÖ Using AllOrigins Proxy method', 'success');
        }

        function getProxiedUrl(originalUrl) {
            switch(currentMethod) {
                case 'cors':
                    // Using a public CORS proxy
                    return `https://corsproxy.io/?${encodeURIComponent(originalUrl)}`;
                
                case 'allorigins':
                    // Using allorigins proxy
                    return `https://api.allorigins.win/raw?url=${encodeURIComponent(originalUrl)}`;
                
                case 'direct':
                default:
                    return originalUrl;
            }
        }

        function loadStream(streamUrl) {
            document.getElementById('streamUrl').value = streamUrl;
            loadCustomStream();
        }

        function loadCustomStream() {
            const streamUrl = document.getElementById('streamUrl').value.trim();
            
            if (!streamUrl) {
                updateStatus('‚ùå Please enter a stream URL', 'error');
                return;
            }

            updateStatus(`‚è≥ Loading stream using ${currentMethod} method...`, 'info');

            // Destroy existing player
            if (player) {
                player.dispose();
            }

            // Get the proxied URL based on selected method
            const finalUrl = getProxiedUrl(streamUrl);
            console.log('Loading URL:', finalUrl);

            // Initialize Video.js player
            try {
                player = videojs('videoPlayer', {
                    controls: true,
                    autoplay: true,
                    preload: 'auto',
                    fluid: true,
                    html5: {
                        hls: {
                            overrideNative: true
                        }
                    }
                });

                player.ready(function() {
                    player.src({
                        src: finalUrl,
                        type: 'application/x-mpegURL'
                    });

                    player.on('loadstart', function() {
                        updateStatus('‚úÖ Stream loaded successfully!', 'success');
                    });

                    player.on('playing', function() {
                        updateStatus('üé¨ Video is now playing!', 'success');
                    });

                    player.on('error', function() {
                        const error = player.error();
                        const errorMsg = error ? error.message : 'Unknown error';
                        updateStatus(`‚ùå Player error: ${errorMsg}`, 'error');
                        
                        // Suggest trying different method
                        if (currentMethod === 'direct') {
                            updateStatus('üí° Try using a CORS proxy instead', 'info');
                        }
                    });
                });

            } catch (error) {
                updateStatus(`‚ùå Setup error: ${error.message}`, 'error');
            }
        }

        // Initialize player when page loads
        document.addEventListener('DOMContentLoaded', function() {
            player = videojs('videoPlayer', {
                controls: true,
                preload: 'auto',
                fluid: true
            });
            
            updateStatus('‚úÖ Ready! Click a test stream above to start.', 'success');
        });
    </script>
</body>
</html>
